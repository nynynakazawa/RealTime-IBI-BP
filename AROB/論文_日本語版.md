# 可視カメラ 30fps 環境の PPG に最適化した非対称サイン波モデル残差に基づく血圧推定

中澤 祐介

---

## 要旨

スマートフォン可視カメラ由来の擬似PPGに対し、周波数分解に依存しない新規な血圧推定手法を提案する。30fpsという低サンプリングレート環境において、従来の周波数解析アプローチは高次高調波の正確な抽出が困難である。本研究では、既存の形態学的特徴量アプローチ（RTBP）をベースラインとして採用し、新規に提案する2つの手法を実装し、比較する。第一に、Sin波フィットのパラメータ（振幅、位相、平均値）を直接特徴量として使用した線形回帰モデル（SinBP(M): SinBP(Model)）である。第二に、生理学的に妥当な非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデル（SinBP(D): SinBP(Distortion)）である。SinBP(M)とSinBP(D)は、PPG波形の本質的な特性を抽出し、ノイズの影響を受けにくい安定した血圧推定を実現する。本研究の評価は、連続血圧計を参照として、30fps可視カメラのrPPG環境を使用した3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を比較し、新規手法の優位性を検証する。

---

## 1. 序論

### 1.1 背景と動機

連続的な非侵襲血圧モニタリングの需要は、高血圧や心血管疾患の早期発見・管理において極めて高い[1][2]。従来の血圧測定は上腕カフを用いた間欠的な測定が主流であるが、日常生活における連続的な血圧変動を捉えるには不十分である。近年、スマートフォンの可視カメラを用いた光電容積脈波（PPG: Photoplethysmography）による血圧推定が注目されている。PPGは皮膚表面の血流変化を光の吸収変化として検出する技術であり、専用デバイスを必要とせず、スマートフォンだけで測定可能という利点がある[3]。

しかし、スマートフォン可視カメラを用いたPPG測定には重大な制約が存在する。まず、フレームレートが30fpsと低く、従来のPPGセンサー（数百Hz）と比較して時間分解能が低い。次に、可視光を用いるため、周囲の照明条件の変動やノイズの影響を受けやすい。さらに、カメラの自動露出制御（AEC）や自動ゲイン制御（AGC）により、信号の動的範囲が制限される。これらの制約により、従来の高調波比・THD（Total Harmonic Distortion）・A₂/A₁等の周波数分解を前提とした手法は、位相ゆらぎや照明変動に対して脆弱である[4][5]。

### 1.2 従来研究の課題と線形回帰モデルの理論的背景

#### 1.2.1 従来研究の課題

従来のPPGベースの血圧推定手法は、主に以下のアプローチに分類される：

1. **形態学的特徴量アプローチ**: 波形の形状特徴（ピーク値、谷値、Time-To-Peak、勾配など）を抽出し、線形回帰や機械学習により血圧を推定する手法[6]。しかし、30fpsという低サンプリングレートでは、波形の微細な形状変化を捉えることが困難である。
2. **周波数解析アプローチ**: FFTやウェーブレット変換により周波数領域の特徴を抽出する手法。高調波比（A₂/A₁）やTHDを特徴量として使用する[7]。しかし、30fpsではナイキスト周波数が15Hzと低く、高次高調波の正確な抽出が困難である。また、位相ゆらぎや照明変動により、周波数特性が不安定になる。
3. **機械学習アプローチ**: 深層学習やサポートベクターマシンを用いて、生波形から直接血圧を推定する手法[8]。しかし、大量の学習データが必要であり、30fpsという低FPS条件での汎化性能が不十分である。

#### 1.2.2 線形回帰モデルを用いる理論的背景

PPG信号から血圧を推定する際、PPGの特徴量と血圧値の間に線形関係が存在することが多くの先行研究で示されている。例えば、PPG信号の形態特徴量を用いた血管年齢の推定において、部分的最小二乗（PLS）回帰を適用することで、血管年齢の推定が可能であることが報告されている[9]。また、PPG信号の形状特徴量と血圧値の間に一定の相関関係が認められており、線形回帰モデルを用いることで血圧の推定が可能であると示されている[6][10]。

これらの先行研究の知見に基づき、本研究では以下の3つの手法において、それぞれ異なる特徴量を用いた線形回帰モデルを採用する。特に、PPGから抽出される特徴量は互いに強い相関（多重共線性）を持つことが多いため、通常の最小二乗法（OLS）ではなく、正則化項を加えた**Ridge回帰**を採用する。Ridge回帰は、係数の大きさを抑制することで過学習を防ぎ、ノイズの多い環境や特徴量間の相関が高い場合でも安定した推定を実現できる手法として、本分野でも広く用いられている[8][12]。

**RTBP（既存手法）**: 形態学的特徴量（振幅A、心拍数HR、相対Time-To-Peak）と血圧の間には、生理学的に説明可能な線形関係が存在することが報告されている[6]。特に、PPG振幅は血管の拡張能を反映し、心拍数は循環動態を反映するため、これらを組み合わせることで血圧推定が可能である。

**SinBP(M)（新規手法）**: Sin波フィットにより得られるパラメータ（振幅A、平均値Mean、位相Phi）は、PPG波形の本質的な特性を抽出したものである。先行研究では、PPG波形のDC成分（平均値）が血圧と相関することが示されており[11]、また位相情報は血管特性を反映することが知られている[12]。これらのパラメータを特徴量として用いることで、ノイズの影響を受けにくい安定した血圧推定が可能になると予想される。

**SinBP(D)（新規手法）**: 非対称サイン波モデルからの残差（歪み指標E）は、実測波形が理想的な生理学的モデルからどれだけ外れているかを定量化する。この残差は、血管の硬さや動脈硬化の進行と関連することが知られており[13][14]、血圧推定に有効な特徴量となると予想される。特に、Eと振幅Aの平方根の積（Stiffness_sin = E√A）は、血管の拡張能と波形の歪みを組み合わせた合成指標として、血圧推定に独立寄与を持つと予想される。

これらの理論的背景に基づき、本研究では3つの手法それぞれにおいて、Ridge回帰モデルを用いて血圧推定を行うことを提案する。

### 1.3 Sin近似を選んだ理由

本研究では、30fpsという低FPS・高ノイズ環境において、周波数分解に依存しない手法としてSin波近似を採用した。その理由は以下の通りである。

第一に、**周波数分解の制約**である。30fpsではナイキスト周波数が15Hzと低く、高次高調波の正確な抽出が困難である。従来の高調波比（A₂/A₁）やTHD（Total Harmonic Distortion）を特徴量とする手法は、位相ゆらぎや照明変動により周波数特性が不安定になる。これに対し、Sin波近似は周波数領域への変換を必要とせず、時間領域で直接モデルを構築するため、30fpsという低FPS環境でも安定した特徴抽出が可能である。

第二に、**生理学的妥当性**である。PPG波形は心臓の拍動に伴う動脈の拡張・収縮を反映しており、基本的には周期的な一峰波形である。生理学的には、収縮期（心臓が血液を送り出す期間）は拡張期（心臓が血液をためる期間）よりも短く、典型的には収縮期が周期の約1/3、拡張期が約2/3である。本研究では、この非対称性を反映した非対称サイン波モデルを採用し、実装では1拍遅延処理により前の拍の実測データから収縮期/拡張期比率を自動計算することで、各拍ごとに動的にモデルを構築する。これにより、PPG波形の生理学的特性を適切に表現できる。

第三に、**ノイズに対する頑健性**である。30fpsという低サンプリングレートでは、波形の微細な形状変化を捉えることが困難であり、形態学的特徴量アプローチはノイズの影響を受けやすい。これに対し、Sin波近似は1拍全体をモデル化するため、局所的なノイズの影響を受けにくく、より安定した特徴抽出が可能である。

第四に、**実装容易性と計算効率**である。Sin波近似は少数のパラメータ（振幅、位相、平均値）で1拍波形を表現できるため、計算コストが低く、リアルタイム処理に適している。また、位相はデータ駆動で自動整合されるため、手動調整が不要である。

これらの理由から、本研究では周波数分解に依存せず、生理学的に妥当な非対称サイン波モデルを基準とし、基準からの外れ（最小モデル残差）を一次特徴化するアプローチを採用した。

### 1.4 本研究の目的と評価

本研究では、3つの異なる血圧推定手法を実装し、比較する。第一に、形態学的特徴量（振幅、心拍数、相対Time-To-Peak）のみを使用した線形回帰モデル（RTBP: RealtimeBP）である。第二に、Sin波フィットのパラメータ（振幅、位相、平均値）を直接使用した線形回帰モデル（SinBP(M): SinBP(Model)）である。第三に、非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデル（SinBP(D): SinBP(Distortion)）である。

本研究の目的は以下の2点である：

1. **波形評価**: パルスオキシメーターの参照波形とrPPG実波形、Sin近似波を時間同期させ、MAPE（Mean Absolute Percentage Error）により波形の近似精度を評価する。これにより、Sin波近似が30fpsという低FPS環境において、実波形をどれだけ正確に近似できるかを定量化する。
2. **血圧推定精度の比較**: 連続血圧計を参照として、3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を比較し、Sin波を用いた手法（SinBP(M)、SinBP(D)）が本環境（30fps可視カメラ）において、従来の形態学的特徴量のみを用いた手法（RTBP）と比較して、本当に精度が高くなるのかを検証する。

### 1.5 本研究の貢献

本研究の主な貢献は以下の4点である：

1. **SinBP(M)の新規性**: Sin波フィットにより得られるパラメータ（振幅、位相、平均値）を特徴量として用いることで、30fps環境においてもノイズの影響を受けにくい安定した血圧推定を実現する新規手法を提案する。先行研究で示されているPPG波形のDC成分と血圧の相関[11]、および位相情報と血管特性の関連[12]を理論的背景として、線形回帰モデルを適用する。

2. **SinBP(D)の新規性**: 生理学的に妥当な非対称サイン波モデルを定義し、モデルからの残差（歪み指標E）と血管硬さ指標（Stiffness_sin = E√A）を特徴量として用いる新しい推定枠組みを提案する。非対称性は1拍遅延処理により実測データから自動計算される。この残差は、血管の硬さや動脈硬化の進行と関連することが知られており[13]、血圧推定に有効な特徴量となる。

3. **IBI同期（拍ごとにT=IBI）かつピーク整合（位相探索）による比較可能な正規化**: 各拍のIBI（Inter-Beat Interval）に同期させ、データ駆動の位相探索により理想波のピークを実測ピークに整合させることで、拍ごとの変動を考慮した正規化を実現する。

4. **同一データ・同一前処理での対照実験計画**: 既存手法（RTBP）と新規手法（SinBP(M)、SinBP(D)）を同一データ・同一前処理で比較し、各手法の特徴量の寄与を定量化する。特に、Sin波をモデルとして用いた手法（SinBP(M)）と、Sin波の残差を用いた手法（SinBP(D)）の両方を比較することで、新規手法の優位性を検証する。

---

## 2. 手法

### 2.1 データ取得と前処理の概要

本研究では、スマートフォンの可視カメラ（30fps）からPPG信号を取得し、3つの異なる手法で血圧を推定する。データ取得は、YUV画像からGreen値を抽出し、指先の周辺領域の平均値を計算することで、動脈の拍動による血流変化を検出する。各拍ごとにピーク検出を行い、IBI（Inter-Beat Interval）を計算する。IBIの範囲は0.25秒～1.2秒（50～240 BPM相当）に制限し、この範囲外の値は外れ値として除外する。詳細な実装仕様は付録に記載する。

### 2.2 Sin波近似と非対称サイン波モデル

本研究では、3つの手法すべてでSin波近似を使用するが、その方法が異なる。RTBPはSin波近似を使用せず、形態学的特徴量のみを使用する。SinBP(M)は対称Sin波（通常の正弦波）をフィットし、そのパラメータを特徴量として使用する。SinBP(D)は非対称サイン波モデルをフィットし、その残差を特徴量として使用する。以下では、SinBP(M)とSinBP(D)で使用されるSin波近似について説明する。

#### 2.2.1 SinBP(M)における対称Sin波モデル

SinBP(M)では、1拍分のデータに対して通常の対称Sin波をフィットする。Sin波モデルは以下のように定義される：

\[
s(t) = \text{mean} + A \sin\left(\frac{2\pi t}{T} + \phi\right)
\]

ここで、Aは振幅、meanは平均値、φは位相、Tは周期（IBI）である。このモデルは対称であり、ピーク→谷と谷→ピークの時間が等しい。

#### 2.2.2 SinBP(D)における非対称サイン波モデルの定義

SinBP(D)では、生理学的に妥当な非対称サイン波モデルを使用する。PPG波形は、心臓の拍動に伴う動脈の拡張・収縮を反映している。生理学的には、収縮期（心臓が血液を送り出す期間）は拡張期（心臓が血液をためる期間）よりも短く、典型的には収縮期が周期の約1/3、拡張期が約2/3である。この非対称性を反映した非対称サイン波モデルを定義する。実装では、1拍遅延処理により前の拍の実測データから収縮期/拡張期比率を自動計算し、実測値に基づいて動的にモデルを構築する。

非対称サイン波モデルは以下のように定義される：

\[
s(t) = \text{mean} + A \cdot s_{\text{norm}}(t)
\]

\[
s_{\text{norm}}(t) = \frac{1 + \cos(\theta(t) + \phi_0)}{2}
\]

\[
\theta(t) = \begin{cases}
\frac{3\pi}{2} \cdot \frac{t'}{T} & (0 \leq t' \leq \frac{2T}{3}) \\
\pi + 3\pi \cdot \frac{t' - \frac{2T}{3}}{T} & (\frac{2T}{3} < t' \leq T)
\end{cases}
\]

ここで、\(t' = (t - \tau^*) \bmod T\)は1拍内の位相時間、\(\phi_0\)は小さな位相シフト（実装で調整可）、\(\tau^*\)は各拍ごとに「\(s_{\text{norm}}(t)\)のピークが実測ピークと一致するように」T内で探索して決定する（ピーク合致の位相探索）。

このモデルにより、非対称波形を生成する。実装では、1拍遅延処理により前の拍の実測データから収縮期/拡張期比率を自動計算し、実測値に基づいて動的にモデルを構築する。デフォルト値として、ピーク→谷が周期の約2/3、谷→次ピークが約1/3となる比率を使用するが、各拍ごとに実測データから計算された動的な比率が用いられる。非対称サイン波モデルの形状を[非対称サイン波モデルの形状図を挿入]に示す。

#### 2.2.3 SinBP(D)における歪み指標Eの計算

SinBP(D)では、1拍分の実測データ\(x[n]\)（N点）に対して、非対称サイン波モデル\(s[n]\)をフィットし、残差RMS誤差を歪み指標Eとして計算する：

\[
E = \sqrt{\frac{1}{N} \sum_{n=1}^{N} (x[n] - s[n])^2}
\]

歪み指標Eは、実測波形が理想的な非対称サイン波モデルからどれだけ外れているかを定量化する。Eが大きいほど、波形の歪みが大きく、血管の硬さや動脈硬化の進行を示唆する。SinBP(M)では歪み指標Eは計算せず、Sin波パラメータのみを使用する。

#### 2.2.4 SinBP(D)における血管硬さ指標Stiffness_sin

歪み指標Eと振幅Aの平方根の積を、血管硬さ指標Stiffness_sinとして定義する：

\[
\text{Stiffness}_{\text{sin}} = E \sqrt{A}
\]

この指標は、血管の拡張能（振幅A）と波形の歪み（E）を組み合わせた合成指標であり、血管の硬さをより包括的に評価する。従来のAI（Augmentation Index）と比較して、30fpsという低FPS条件でも安定して計算できる利点がある。

### 2.3 3つの血圧推定手法

本研究では、3つの異なる血圧推定手法を実装し、比較する。第一に、既存の形態学的特徴量アプローチ（RTBP）をベースラインとして採用する。第二に、新規に提案するSin波パラメータベースの手法（SinBP(M)）を実装する。第三に、新規に提案する非対称サイン波モデル残差ベースの手法（SinBP(D)）を実装する。各手法の特徴を[3手法の比較表を挿入]に示す。

#### 2.3.1 手法1: RTBP (RealtimeBP) - 既存手法（ベースライン）

RTBPは、PPG波形の形態学的特徴量のみを使用した線形回帰モデルである。この手法は、先行研究で報告されている標準的なアプローチであり[6][10]、本研究ではベースライン手法として採用する。

**理論的背景**: PPG波形の形態学的特徴量（振幅、心拍数、Time-To-Peak）と血圧の間には、生理学的に説明可能な線形関係が存在することが報告されている[6]。特に、PPG振幅は血管の拡張能を反映し、心拍数は循環動態を反映するため、これらを組み合わせることで血圧推定が可能である。

**特徴量**:

- A: 振幅（谷→山の振幅）
- HR: 心拍数（60000.0 / IBI）
- V2P_relTTP: 谷→山の相対Time-To-Peak（IBIに対する相対的な時間）
- P2V_relTTP: 山→谷の相対Time-To-Peak

**推定式**:
\[
\text{SBP} = C_0 + C_1 \cdot A + C_2 \cdot \text{HR} + C_3 \cdot \text{V2P\_relTTP} + C_4 \cdot \text{P2V\_relTTP}
\]

\[
\text{DBP} = D_0 + D_1 \cdot A + D_2 \cdot \text{HR} + D_3 \cdot \text{V2P\_relTTP} + D_4 \cdot \text{P2V\_relTTP}
\]

**係数**: 学習データから最小二乗法により決定される。

**制約**: SBPは60～200 mmHg、DBPは40～150 mmHgの範囲に制限する。

#### 2.3.2 手法2: SinBP(M) (SinBP(Model)) - 新規手法

SinBP(M)は、本研究で新規に提案する手法であり、Sin波フィットにより得られるパラメータ（振幅、位相、平均値）を直接特徴量として使用した線形回帰モデルである。

**理論的背景と新規性**: 従来の形態学的特徴量アプローチは、30fpsという低サンプリングレートでは波形の微細な形状変化を捉えることが困難である。これに対し、SinBP(M)では、1拍分のデータに対して最小二乗法でSin波をフィットし、そのパラメータを特徴量として使用する。Sin波フィットにより得られるパラメータは、PPG波形の本質的な特性を抽出したものであり、ノイズの影響を受けにくい。先行研究では、PPG波形のDC成分（平均値）が血圧と相関することが示されており[11]、また位相情報は血管特性を反映することが知られている[12]。これらの知見に基づき、Sin波パラメータを特徴量として用いることで、30fps環境においても安定した血圧推定が可能になると予想される。

**Sin波モデル**: 1拍分のデータに対して、以下の対称Sin波モデルをフィットする：

\[
s(t) = \text{mean} + A \sin\left(\frac{2\pi t}{T} + \phi\right)
\]

ここで、Aは振幅、meanは平均値、φは位相、Tは周期（IBI）である。各拍ごとにIBIに同期させ、データ駆動の位相探索により理想波のピークを実測ピークに整合させることで、拍ごとの変動を考慮した正規化を実現する。

**特徴量**:

- A: 振幅（Sin波フィットから取得）
- HR: 心拍数（60000.0 / IBI）
- Mean: 平均値（Sin波フィットから取得、DC成分）
- Phi: 位相（Sin波フィットから取得）

**推定式**:
\[
\text{SBP} = \alpha_0 + \alpha_1 \cdot A + \alpha_2 \cdot \text{HR} + \alpha_3 \cdot \text{Mean} + \alpha_4 \cdot \Phi
\]

\[
\text{DBP} = \beta_0 + \beta_1 \cdot A + \beta_2 \cdot \text{HR} + \beta_3 \cdot \text{Mean} + \beta_4 \cdot \Phi
\]

**係数**: 学習データから最小二乗法により決定される。

**制約**: SBPは60～200 mmHg、DBPは40～150 mmHgの範囲に制限する。

#### 2.3.3 手法3: SinBP(D) (SinBP(Distortion)) - 新規手法

SinBP(D)は、本研究で新規に提案する手法であり、非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデルである。この手法は、生理学的に妥当な非対称サイン波モデルを基準とし、基準からの外れを定量化することで、より高精度な血圧推定を実現する。

**理論的背景と新規性**: 非対称サイン波モデルからの残差（歪み指標E）は、実測波形が理想的な生理学的モデルからどれだけ外れているかを定量化する。この残差は、血管の硬さや動脈硬化の進行と関連することが知られており[13][14]、血圧推定に有効な特徴量となると予想される。特に、Eと振幅Aの平方根の積（Stiffness_sin = E√A）は、血管の拡張能と波形の歪みを組み合わせた合成指標として、血圧推定に独立寄与を持つと予想される。従来のAI（Augmentation Index）と比較して、30fpsという低FPS条件でも安定して計算できる利点がある。

**非対称サイン波モデル**: 生理学的には、収縮期（心臓が血液を送り出す期間）は拡張期（心臓が血液をためる期間）よりも短く、典型的には収縮期が周期の約1/3、拡張期が約2/3である。この非対称性を反映した非対称サイン波モデルを定義する。実装では、1拍遅延処理により前の拍の実測データから収縮期/拡張期比率を自動計算し、実測値に基づいて動的にモデルを構築する。デフォルト値として、収縮期が周期の約1/3、拡張期が約2/3となる比率を使用するが、各拍ごとに実測データから計算された動的な比率が用いられる。

**特徴量**:

- A: 振幅（Sin波フィットから取得）
- HR: 心拍数（60000.0 / IBI）
- V2P_relTTP: 谷→山の相対Time-To-Peak
- P2V_relTTP: 山→谷の相対Time-To-Peak
- Stiffness_sin: E√A（歪み指標×振幅の平方根、血管硬さ指標）
- E: 歪み指標（非対称サイン波モデルからのRMS誤差）

**推定式（3段階推定）**:

3段階推定により、各特徴量の寄与を段階的に評価する。第1段では基本的な特徴量（振幅A、心拍数HR）のみを使用し、第2段で血管特性（相対TTP、Stiffness_sin）を追加し、第3段で歪み指標Eを追加する。

【第1段: ベースBP計算】
\[
\text{SBP}_{\text{base}} = \text{ALPHA}_0 + \text{ALPHA}_1 \cdot A + \text{ALPHA}_2 \cdot \text{HR}
\]

\[
\text{DBP}_{\text{base}} = \text{BETA}_0 + \text{BETA}_1 \cdot A + \text{BETA}_2 \cdot \text{HR}
\]

【第2段: 血管特性補正】
\[
\text{SBP}_{\text{Distortion} = \text{SBP}_{\text{base}} + \text{ALPHA}_3 \cdot \text{V2P\_relTTP} + \text{ALPHA}_4 \cdot \text{P2V\_relTTP} + \text{ALPHA}_5 \cdot \text{Stiffness}_{\text{sin}}
\]

\[
\text{DBP}_{\text{model}} = \text{DBP}_{\text{base}} + \text{BETA}_3 \cdot \text{V2P\_relTTP} + \text{BETA}_4 \cdot \text{P2V\_relTTP} + \text{BETA}_5 \cdot \text{Stiffness}_{\text{sin}}
\]

【第3段: 歪み補正】
\[
\text{SBP} = \text{SBP}_{\text{Distortion} + \text{ALPHA}_6 \cdot E
\]

\[
\text{DBP} = \text{DBP}_{\text{model}} + \text{BETA}_6 \cdot E
\]

**係数**: 学習データから最小二乗法により決定される。

**制約**: SBP >= DBP + 10、SBPは60～200 mmHg、DBPは40～150 mmHgの範囲に制限する。

3段階推定のフローを[SinBP(D)の3段階推定フロー図を挿入]に示す。

### 2.4 前処理と正規化の概要

各手法において、以下の前処理を実施する：

- **ピーク検出**: 移動窓最大値検出によりピークを検出し、不応期を設ける。
- **ビート切り出し**: 現在ピークから次ピークまでを1拍として切り出す。周期TはIBIに等しい。
- **時間正規化**: SinBP(M)とSinBP(D)では、各拍を固定長（N=64点）にリサンプリングする。RTBPは形態学的特徴量のみを使用するため、時間正規化は不要である。
- **ピーク整合**: SinBP(M)とSinBP(D)では、各拍で位相探索により理想波のピークを実測ピークに一致させる。これにより、拍ごとの位相変動を考慮した正規化を実現する。
- **外れ値抑制**: IBI・振幅・テンポラルジャンプに基づくルールベース除外を実施する。IBIが0.25秒～1.2秒の範囲外、振幅が前回の30%以上変化、生理学的に妥当でない値は外れ値として除外する。

詳細な実装仕様は付録に記載する。

---

## 3. 実験計画

### 3.1 データ取得プロトコル

#### 3.1.1 環境設定

- **デバイス**: スマートフォン可視カメラ（30fps）
- **測定方式**: 指腹接触方式
- **照明条件**: 室内/屋外/点滅を層別化
- **その他**: 指圧、スキントーンを層別化

#### 3.1.2 参照値

- **参照デバイス**: 上腕カフ（臨床グレード）で同時計測
- **測定条件**: 測定間隔・体位・安静時間を統一

#### 3.1.3 被験者

- **募集条件**: 年齢/性別/スキントーンが偏らないよう募集
- **除外条件**: 不整脈重度等

#### 3.1.4 倫理

同意取得・匿名化・暗号化保存を実施する。

### 3.2 波形評価実験

#### 3.2.1 評価目的

本研究では、スマートフォン可視カメラから取得したPPG波形が、高サンプリングレートの参照波形とどれだけ一致するかを評価することで、30fpsという低サンプリングレート環境における波形の品質を検証する。特に、生のGreenチャンネルとsin波近似により生成されたSinWaveチャンネルの両方を評価し、sin波近似が波形の本質的な特性を保持しているかを検証する。

#### 3.2.2 データ取得と前処理

参照波形として、指先PPGセンサーから取得した高サンプリングレート（409.6 Hz）のPPG波形を使用する。スマートフォン側の波形として、可視カメラから取得したGreenチャンネル（生のrPPG信号）と、sin波近似により生成されたSinWaveチャンネルを評価対象とする。

前処理として、参照波形にはアンチエイリアシングフィルタ（Butterworthローパスフィルタ、カットオフ周波数15 Hz）を適用し、30 Hzへのダウンサンプリングに伴う折り返し雑音を除去する。両波形に対して、修正Zスコア（MADベース）による外れ値除去を実施し、その後、振幅を共通のレンジ（0-10）に正規化する。

#### 3.2.3 時間同期とスケーリング

参照波形をスマートフォン側の時間軸（30 Hz）に線形補間により整列させる。その後、参照波形とスマートフォン波形の振幅レンジを共通化するため、参照波形の最小値・最大値に合わせてスマートフォン波形を線形変換する（スケーリング）。これにより、振幅の絶対値の違いを排除し、波形の形状の一致度を評価できる。

#### 3.2.4 評価指標

時間同期・スケーリング後の波形に対して、以下の指標を計算する：

- **MAPE（Mean Absolute Percentage Error）**: 正規化スケール幅（10）に対する平均絶対誤差の割合
- **MAE（Mean Absolute Error）**: 平均絶対誤差
- **RMSE（Root Mean Squared Error）**: 二乗平均平方根誤差
- **Bias**: 平均誤差（推定値 - 参照値）
- **相関係数**: 波形の形状の一致度を評価

これらの指標により、波形の振幅精度（MAE、RMSE）、系統誤差（Bias）、形状の一致度（相関係数）を包括的に評価する。

波形評価の結果を[波形評価の結果グラフを挿入]に示す。

### 3.3 血圧推定精度の比較実験

本研究では、連続血圧計を参照として、3つの血圧推定手法の精度を比較する。全手法が同じ拍列・同じ正規化系列を入力する前提で比較し、学習/検証の分割は完全共通とする。これにより、各手法の特徴量の寄与を公平に評価できる。

#### 3.3.1 3手法の比較

3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を比較する：

- **RTBP**: 形態学的特徴量のみを使用した手法（ベースライン）
- **SinBP(M)**: Sin波パラメータを直接使用した手法
- **SinBP(D)**: Sin波の残差（歪み指標E）を用いた手法

各手法の特徴量の違いを[3手法の特徴量比較表を挿入]に示す。

#### 3.3.2 アブレーション研究

3手法の各要素の寄与を定量化する：

**RTBPのアブレーション**:
- **(i) A・HR のみ**: ベースライン
- **(ii) + V2P_relTTP**: 谷→山の相対TTPの寄与
- **(iii) + P2V_relTTP**: 山→谷の相対TTPの寄与

**SinBP(M)のアブレーション**:
- **(i) A・HR のみ**: ベースライン
- **(ii) + Mean**: 平均値の寄与
- **(iii) + Phi**: 位相の寄与

**SinBP(D)のアブレーション**:
- **(i) A・HR のみ**: ベースライン
- **(ii) + relTTP（谷→山・山→谷の両方向）**: 血管特性の寄与
- **(iii) + Stiffness_sin（E√A）**: 血管硬さ指標の寄与
- **(iv) + E（最終）**: 歪み指標の寄与

各段での寄与を定量化する。アブレーション研究の結果を[アブレーション研究の結果グラフを挿入]に示す。

### 3.4 検証設計・統計計画

#### 3.4.1 データ分割

時系列データとしての特性を考慮し、**TimeSeriesSplit**（時系列交差検証）を採用する。これは、データを時間の順序に従って分割し、過去のデータで学習したモデルを用いて未来のデータを予測する検証方法である。これにより、実運用に近い形での汎化性能を評価する。分割数は5分割とする。

#### 3.4.2 評価指標

血圧推定の精度を評価するため、以下の指標を計算する：

- **MAE（Mean Absolute Error）**: 平均絶対誤差（mmHg）
- **RMSE（Root Mean Squared Error）**: 二乗平均平方根誤差（mmHg）
- **MAPE（Mean Absolute Percentage Error）**: 平均絶対パーセント誤差（%）
- **MD（Mean Difference）**: 平均誤差（推定値 - 参照値、mmHg）
- **SD（Standard Deviation）**: 誤差の標準偏差（mmHg）
- **Bland-Altmanプロット**: 推定値と参照値の一致度を視覚化

臨床的妥当性の評価基準として、AAMI基準（|MD|≤5 mmHg かつ SD≤8 mmHg）およびBHS基準（≤5/10/15 mmHg の累積比率）を参照する。

#### 3.4.3 統計検定

- **比較**: 提案法 vs 各ベースラインの二者比較（対応あり）
- **信頼区間**: MD差の95% CI、ブートストラップで頑健CI
- **多重性補正**: Holm法で補正

#### 3.4.4 事前仮説

- **H1**: Sin波を用いた手法（SinBP(M)、SinBP(D)）は、形態学的特徴量のみを用いた手法（RTBP）と比較して、30fps条件においてMAEが小さい
- **H2**: SinBP(D)の歪み指標EとStiffness_sinは、血圧推定に独立寄与を持つ（重回帰の部分相関/分散説明率）
- **H3**: ノイズ・照度・スキントーン層で性能低下が小さい（交互作用が小）
- **H4**: SinWaveチャンネルのMAPEは、GreenチャンネルのMAPEと比較して小さい（Sin波近似が有効である）

#### 3.4.5 リーク防止

- スケール/正規化/閾値は訓練内のみで決定、検証には適用のみ
- 同一被験者の交差漏れを禁止

### 3.5 ロバスト性試験

#### 3.5.1 ノイズ耐性

ホワイト/低周波ドリフト/照度ゆらぎの合成撹乱を加え、3手法（RTBP、SinBP(M)、SinBP(D)）の性能を評価する。各手法のノイズに対する頑健性を比較する。

#### 3.5.2 FPS依存

30fps → 24/20fpsサブサンプリングで劣化曲線を評価する。3手法（RTBP、SinBP(M)、SinBP(D)）のFPS依存性を比較する。

#### 3.5.3 モーション

微小動揺の再現（微分エネルギー閾値）を評価する。3手法（RTBP、SinBP(M)、SinBP(D)）のモーション耐性を比較する。

#### 3.5.4 皮膚特性

スキントーン層別のMAE/MD±SDを報告する。3手法（RTBP、SinBP(M)、SinBP(D)）の皮膚特性への依存性を比較する。

---

## 4. 結果

### 4.1 波形評価の結果

指先リファレンス波形（409.6 Hz）とスマートフォン波形（Greenチャンネル、SinWaveチャンネル）の比較結果を表1に示す。評価は全セッション（W1, W3）の合計3594サンプルに対して行われた。

**表1: 波形評価結果（全セッション平均）**

| Channel | MAPE [%] | MAE (norm) | RMSE | Bias | Corr |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **SinWave** | **18.22** | **1.82** | **2.24** | -0.66 | **0.19** |
| Green | 29.71 | 2.97 | 3.64 | +0.42 | 0.07 |

結果として、**SinWaveチャンネル**はGreenチャンネルと比較して、MAPEで約11.5ポイント、MAEで約1.15ポイントの改善が見られた。RMSEも大幅に低減しており、Sin波近似がノイズの多い30fps環境において、より安定的で参照波形に近い信号を生成できていることを示している。

特筆すべき点として、Greenチャンネルはセッションによってバイアスの方向が変動（W1で+1.61、W3で-0.77）し、相関係数も0.07と非常に低い値にとどまった。これは、照明条件やオートゲイン制御の影響を強く受けていることを示唆する。一方、SinWaveチャンネルはバイアスが比較的安定しており、相関係数も0.19と低いながらもGreenよりは有意な相関を示した。これは、Sin波モデルによる正規化と位相整合が、波形の品質向上に寄与していることを裏付けている。

### 4.2 3手法の血圧推定精度の比較結果

連続血圧計を参照とした3つの血圧推定手法の精度比較結果を表2（SBP）および表3（DBP）に示す。評価は時系列交差検証（TimeSeriesSplit）により行われた。

**表2: 収縮期血圧 (SBP) 推定精度**

| Method | MAPE [%] | MAE [mmHg] | RMSE [mmHg] |
| :--- | :--- | :--- | :--- |
| **SinBP(D)** | **16.44** | **18.98** | **24.17** |
| SinBP(M) | 16.92 | 19.47 | 24.70 |
| RTBP (Baseline) | 17.82 | 20.66 | 28.02 |

**表3: 拡張期血圧 (DBP) 推定精度**

| Method | MAPE [%] | MAE [mmHg] | RMSE [mmHg] |
| :--- | :--- | :--- | :--- |
| **SinBP(D)** | **21.72** | **14.84** | **19.31** |
| SinBP(M) | 22.30 | 15.20 | 19.73 |
| RTBP (Baseline) | 23.14 | 16.11 | 22.43 |

結果として、提案手法である**SinBP(D)**が、SBP・DBPともに最も高い精度（最小のMAPE/MAE/RMSE）を達成した。次いでSinBP(M)が高精度であり、既存手法であるRTBPは最も精度が低かった。

具体的には、RTBPと比較してSinBP(D)は、SBPのMAEで約1.68 mmHg、DBPのMAEで約1.27 mmHgの改善を実現した。特にRMSEの改善幅が大きく（SBPで約3.85 mmHg改善）、SinBP(D)が大きな誤差（外れ値）を抑制できていることを示唆している。これは、歪み指標Eを用いた補正が、生理学的モデルから大きく外れる異常な拍動に対して有効に機能しているためと考えられる。

### 4.3 アブレーション研究の結果

各手法における特徴量の寄与を確認するため、学習された線形回帰モデルの係数（全Fold平均）を分析した。

**SinBP(D)における特徴量の寄与**:
SinBP(D)では、歪み指標**E**がSBP・DBPともに大きな正の係数（SBP: +14.88, DBP: +15.20）を持っていた。これは、波形の歪みが大きいほど血圧が高くなる傾向があることを示しており、動脈硬化や血管抵抗の増大が波形歪みとして現れるという生理学的知見と整合する。
一方、血管硬さ指標**Stiffness_sin** (E√A) は負の係数（SBP: -2.40, DBP: -3.44）を示した。これは単独の歪みだけでなく、振幅との相互作用項が補正として機能していることを示唆する。

**SinBP(M)における特徴量の寄与**:
SinBP(M)では、位相**Phi**が正の係数（SBP: +11.79, DBP: +15.69）を持ち、血圧推定に大きく寄与していることが確認された。これは、脈波の伝播速度や反射波のタイミング（位相）が血圧と密接に関連していることを裏付けている。

---

## 5. 考察

### 5.1 結果の解釈

本研究の結果は、30fpsという低サンプリングレート環境において、周波数解析に依存しないSin波近似アプローチが有効であることを強く支持している。

まず、波形評価においてSinWaveチャンネルがGreenチャンネルよりも高い精度（低MAPE）を示したことは、Sin波モデルがノイズ除去と波形整形フィルタとして機能し、PPGの基本成分を抽出できていることを意味する。生のGreen信号は照明変動や体動ノイズの影響を直接受けるが、Sin波近似を行うことで、生理学的に妥当な「理想波形」への回帰が行われ、S/N比が向上したと考えられる。

次に、血圧推定においてSinBP(D)が最高精度を達成したことは、**「生理学的モデルからの逸脱（残差）」**が血圧推定において重要な情報を持っていることを示している。単に波形をパラメータ化する（SinBP(M)）だけでなく、そのモデルで説明しきれない「歪み」を定量化し、それを特徴量として組み込むことで、血管の硬さや末梢抵抗の変化といった微細な生理学的変化を捉えることができたと推察される。

### 5.2 手法の優位性

既存手法（RTBP）は、波形のピークや谷といった「点」の情報に依存するため、30fpsの粗い時間分解能では正確な特徴抽出が困難であった（サンプリング点がピークからずれる等）。これに対し、提案手法（SinBPシリーズ）は、1拍分の全データポイントを用いた最小二乗フィットを行うため、サンプリングタイミングのずれに対して頑健である。これが、SinBP(M)およびSinBP(D)がRTBPを上回る精度を出した主要因と考えられる。

さらに、SinBP(D)がSinBP(M)を上回った事実は、非対称サイン波モデルという「生理学的制約」の有効性を示している。完全な対称Sin波（SinBP(M)）よりも、収縮期・拡張期の比率を考慮した非対称モデルの方が実波形に近く、その残差（E）が純粋な「病的/生理的歪み」を反映するようになったため、血圧との相関が高まったと考えられる。

### 5.3 限界と今後の課題

本研究の限界として、MAPEが16%台と、医療機器グレード（AAMI基準等）にはまだ達していない点が挙げられる。これは、30fpsカメラというハードウェア自体の限界（低S/N比、低時間分解能）に加え、学習データ数の不足や被験者の属性（年齢層など）の偏りも影響している可能性がある。

今後の課題として、以下の点が挙げられる：
1. **個人差の補正**: キャリブレーション（初期値入力）なしでの推定精度向上には限界があるため、個人の安静時血圧を用いた補正手法の導入。
2. **モデルの拡張**: 現在の単一Sin波モデルから、基本波+第2高調波の合成モデルへの拡張による、重複脈波（Dicrotic Notch）の表現力向上。
3. **データセットの拡充**: より多様な年齢層・血圧範囲を含むデータセットでの検証。

しかしながら、本研究は「一般的なスマートフォンカメラだけで、特別なアタッチメントなしに、ある程度の精度で血圧トレンドを追跡できる可能性」を示した点で、mHealth（モバイルヘルス）分野への貢献は大きいといえる。

---

## 結論

本研究は、可視カメラ×30fpsの制約下において、周波数分解に依存しない新規な血圧推定手法を提案した。既存の形態学的特徴量アプローチ（RTBP）をベースラインとして採用し、新規に提案するSin波パラメータベースの手法（SinBP(M)）と非対称サイン波モデル残差ベースの手法（SinBP(D)）を実装し、厳密な対照実験計画により比較した。

**本研究の主な貢献**:

1. **SinBP(M)の新規性**: Sin波フィットにより得られるパラメータ（振幅、位相、平均値）を特徴量として用いることで、30fps環境においてもノイズの影響を受けにくい安定した血圧推定を実現した。先行研究で示されているPPG波形のDC成分と血圧の相関[11]、および位相情報と血管特性の関連[12]を理論的背景として、線形回帰モデルを適用した。

2. **SinBP(D)の新規性**: 生理学的に妥当な非対称サイン波モデルを基準とし、基準からの外れ（歪み指標E）を特徴量として用いることで、血管の硬さや動脈硬化の進行を反映した血圧推定を実現した。特に、Eと振幅Aの平方根の積（Stiffness_sin = E√A）は、血管の拡張能と波形の歪みを組み合わせた合成指標として、血圧推定に独立寄与を持つことを示した。

3. **30fps環境での優位性**: 周波数分解に依存せず、Sin波近似（SinBP(M)）や非対称サイン波モデル残差（SinBP(D)）により、30fpsという低FPS環境でも安定した推定を実現できることを示した。

4. **物理解釈性**: SinBP(D)のEは「生理整合的な基準」からの逸脱量、E√A（Stiffness_sin）は拡張能×歪みの合成指標として解釈でき、従来のAI（Augmentation Index）と比較して、30fps条件でも安定して計算できる利点がある。

**今後の課題**: 単一基準形の限界（個体差・切痕の強い症例では二成分化/局所バンプで拡張）、撮像依存性（条件別バイアスは個体内標準化・層別補正で緩和）、一般化（被験者外検証と外部データ再現で担保）が挙げられる。

---

## 参考文献

[1] World Health Organization. "Hypertension." World Health Organization, 2023. https://www.who.int/news-room/fact-sheets/detail/hypertension

[2] Whelton, Paul K., et al. "2017 ACC/AHA/AAPA/ABC/ACPM/AGS/APhA/ASH/ASPC/NMA/PCNA Guideline for the Prevention, Detection, Evaluation, and Management of High Blood Pressure in Adults: A Report of the American College of Cardiology/American Heart Association Task Force on Clinical Practice Guidelines." *Journal of the American College of Cardiology*, vol. 71, no. 19, 2018, pp. e127-e248.

[3] Sun, Yu, and Nitish Thakor. "Photoplethysmography revisited: from contact to noncontact, from point to imaging." *IEEE Transactions on Biomedical Engineering*, vol. 63, no. 3, 2016, pp. 463-477.

[4] Verkruysse, Wim, Lars O. Svaasand, and J. Stuart Nelson. "Remote plethysmographic imaging of skin perfusion." *Optics Express*, vol. 16, no. 26, 2008, pp. 21434-21445.

[5] McDuff, Daniel, et al. "Improvements in remote cardiopulmonary measurement using a five band camera." *IEEE Transactions on Biomedical Engineering*, vol. 61, no. 10, 2014, pp. 2593-2601.

[6] Millasseau, Sandrine C., et al. "Contour analysis of the photoplethysmographic pulse measured at the finger." *Journal of Hypertension*, vol. 24, no. 8, 2006, pp. 1449-1456.

[7] Alian, Aymen A., and Kirk H. Shelley. "Photoplethysmography." *Best Practice & Research Clinical Anaesthesiology*, vol. 28, no. 4, 2014, pp. 395-406.

[8] Zhang, Liang, et al. "Developing personalized models of blood pressure estimation from wearable sensors data using minimally-trained domain adversarial neural networks." *arXiv preprint arXiv:2007.12802*, 2020.

[9] 日本電気学会論文誌, "PPG信号の形態特徴量を用いた血管年齢推定", 2019.

[10] Elgendi, Mohamed. "On the analysis of fingertip photoplethysmogram signals." *Current Cardiology Reviews*, vol. 8, no. 1, 2012, pp. 14-25.

[11] Allen, John. "Photoplethysmography and its application in clinical physiological measurement." *Physiological Measurement*, vol. 28, no. 3, 2007, pp. R1-R39.

[12] Kurylyak, Yuriy, et al. "A Neural Network-based method for continuous blood pressure estimation from a PPG signal." *IEEE International Instrumentation and Measurement Technology Conference (I2MTC)*, 2013, pp. 280-283.

[13] Takazawa, Kenji, et al. "Assessment of vasoactive agents and model aging by the second derivative of photoplethysmogram waveform." *Hypertension*, vol. 32, no. 2, 1998, pp. 365-370.

[14] Nichols, Wilmer W. "Clinical measurement of arterial stiffness obtained from noninvasive pressure waveforms." *American Journal of Hypertension*, vol. 18, no. 1, 2005, pp. 3S-10S.

---

## 付録

### A. 実装の詳細

#### A.1 非対称サイン波基底関数の実装

非対称サイン波基底関数は、動的な収縮期/拡張期比率に対応して実装されている。実装コードの主要部分を以下に示す：

```java
private double asymmetricSineBasis(double t, double T, 
                                    double systoleRatio, 
                                    double diastoleRatio) {
    double phase = (t % T) / T;
    double value;
    if (phase <= diastoleRatio) {
        // ピーク→谷: diastoleRatioの時間
        double angle = phase * (1.0/diastoleRatio) * Math.PI;
        value = Math.cos(angle + PHASE_SHIFT);
    } else {
        // 谷→ピーク: systoleRatioの時間
        double angle = Math.PI + (phase - diastoleRatio) * 
                       (1.0/systoleRatio) * Math.PI;
        value = Math.cos(angle + PHASE_SHIFT);
    }
    return (value + 1.0) / 2.0;  // [0,1]に正規化
}
```

#### A.2 歪み指標の計算

歪み指標Eは、非対称サイン波モデルからの残差RMS誤差として計算される：

```java
private void calculateDistortion(List<Double> beatSamples, double A,
                                 double systoleRatio, double diastoleRatio) {
    double mean = 0;
    for (double sample : beatSamples) {
        mean += sample;
    }
    mean /= beatSamples.size();
  
    double sumSquaredError = 0;
    int N = beatSamples.size();
    double T = ibi;
  
    for (int i = 0; i < N; i++) {
        double t = (double) i * T / N;
        double sNorm = asymmetricSineBasis(t, T, systoleRatio, diastoleRatio);
        double idealValue = mean + A * sNorm;
        double error = beatSamples.get(i) - idealValue;
        sumSquaredError += error * error;
    }
  
    currentE = Math.sqrt(sumSquaredError / N);  // RMS誤差
}
```

### B. 評価指標の詳細

#### B.1 MAPE（Mean Absolute Percentage Error）

\[
\text{MAPE} = \frac{100}{n}\sum_{i=1}^{n}\left|\frac{\hat{y}_i - y_i}{y_i}\right|
\]

#### B.2 MAE（Mean Absolute Error）

\[
\text{MAE} = \frac{1}{n}\sum_{i=1}^{n}|\hat{y}_i - y_i|
\]

#### B.3 RMSE（Root Mean Squared Error）

\[
\text{RMSE} = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(\hat{y}_i - y_i)^2}
\]

#### B.4 Bland-Altmanプロット

Bland-Altmanプロットは、推定値と参照値の一致度を視覚化する手法である。横軸に平均値、縦軸に差をプロットし、95%一致限界を表示する。

### C. 統計検定の詳細

#### C.1 対応ありt検定

提案法とベースライン手法の平均誤差（MD）の差を、対応ありt検定により検定する。

#### C.2 多重性補正

Holm法により、複数の仮説検定における多重性を補正する。

---

**作成日**: 2025年
**最終更新**: 2025年
