# 可視カメラ 30fps 環境の PPG に最適化した非対称サイン波モデル残差に基づく血圧推定

中澤 祐介

---

## 要旨

スマートフォン可視カメラ由来の擬似PPGに対し、周波数分解に依存しない「最小モデル残差」による血圧推定（SinBP）を提案する。本研究では、3つの異なる血圧推定手法を実装し、比較する。第一に、形態学的特徴量（振幅、心拍数、相対Time-To-Peak）のみを使用した線形回帰モデル（RTBP: RealtimeBP）である。第二に、Sin波フィットのパラメータ（振幅、位相、平均値）を直接使用した線形回帰モデル（SinBP(M): SinBPModel）である。第三に、非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデル（SinBP(D): SinBPDistortion）である。

本研究の評価は2つの観点から実施する。第一に、パルスオキシメーターの参照波形とrPPG実波形、Sin近似波を時間同期させ、MAPEにより波形の近似精度を評価する。第二に、連続血圧計を参照として、30fps可視カメラのrPPG環境を使用した3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を比較し、Sin波を用いた手法が本環境において本当に精度が高くなるのかを検証する。

---

## 1. 序論

### 1.1 背景と動機

連続的な非侵襲血圧モニタリングの需要は、高血圧や心血管疾患の早期発見・管理において極めて高い。従来の血圧測定は上腕カフを用いた間欠的な測定が主流であるが、日常生活における連続的な血圧変動を捉えるには不十分である。近年、スマートフォンの可視カメラを用いた光電容積脈波（PPG: Photoplethysmography）による血圧推定が注目されている。PPGは皮膚表面の血流変化を光の吸収変化として検出する技術であり、専用デバイスを必要とせず、スマートフォンだけで測定可能という利点がある。

しかし、スマートフォン可視カメラを用いたPPG測定には重大な制約が存在する。まず、フレームレートが30fpsと低く、従来のPPGセンサー（数百Hz）と比較して時間分解能が低い。次に、可視光を用いるため、周囲の照明条件の変動やノイズの影響を受けやすい。さらに、カメラの自動露出制御（AEC）や自動ゲイン制御（AGC）により、信号の動的範囲が制限される。これらの制約により、従来の高調波比・THD（Total Harmonic Distortion）・A₂/A₁等の周波数分解を前提とした手法は、位相ゆらぎや照明変動に対して脆弱である。

### 1.2 従来研究の課題

従来のPPGベースの血圧推定手法は、主に以下のアプローチに分類される：

1. **形態学的特徴量アプローチ**: 波形の形状特徴（ピーク値、谷値、Time-To-Peak、勾配など）を抽出し、線形回帰や機械学習により血圧を推定する手法。しかし、30fpsという低サンプリングレートでは、波形の微細な形状変化を捉えることが困難である。
2. **周波数解析アプローチ**: FFTやウェーブレット変換により周波数領域の特徴を抽出する手法。高調波比（A₂/A₁）やTHDを特徴量として使用する。しかし、30fpsではナイキスト周波数が15Hzと低く、高次高調波の正確な抽出が困難である。また、位相ゆらぎや照明変動により、周波数特性が不安定になる。
3. **機械学習アプローチ**: 深層学習やサポートベクターマシンを用いて、生波形から直接血圧を推定する手法。しかし、大量の学習データが必要であり、30fpsという低FPS条件での汎化性能が不十分である。

これらの課題を解決するため、本研究では周波数分解に依存せず、生理学的に妥当な非対称一峰波形を基準とし、基準からの外れ（最小モデル残差）を一次特徴化するアプローチを提案する。

### 1.3 Sin近似を選んだ理由

本研究では、30fpsという低FPS・高ノイズ環境において、周波数分解に依存しない手法としてSin波近似を採用した。その理由は以下の通りである。

第一に、**周波数分解の制約**である。30fpsではナイキスト周波数が15Hzと低く、高次高調波の正確な抽出が困難である。従来の高調波比（A₂/A₁）やTHD（Total Harmonic Distortion）を特徴量とする手法は、位相ゆらぎや照明変動により周波数特性が不安定になる。これに対し、Sin波近似は周波数領域への変換を必要とせず、時間領域で直接モデルを構築するため、30fpsという低FPS環境でも安定した特徴抽出が可能である。

第二に、**生理学的妥当性**である。PPG波形は心臓の拍動に伴う動脈の拡張・収縮を反映しており、基本的には周期的な一峰波形である。生理学的には、収縮期（心臓が血液を送り出す期間）は拡張期（心臓が血液をためる期間）よりも短く、典型的には収縮期が周期の約1/3、拡張期が約2/3である。この非対称性を反映した非対称サイン波モデルは、PPG波形の生理学的特性を適切に表現できる。

第三に、**ノイズに対する頑健性**である。30fpsという低サンプリングレートでは、波形の微細な形状変化を捉えることが困難であり、形態学的特徴量アプローチはノイズの影響を受けやすい。これに対し、Sin波近似は1拍全体をモデル化するため、局所的なノイズの影響を受けにくく、より安定した特徴抽出が可能である。

第四に、**実装容易性と計算効率**である。Sin波近似は少数のパラメータ（振幅、位相、平均値）で1拍波形を表現できるため、計算コストが低く、リアルタイム処理に適している。また、位相はデータ駆動で自動整合されるため、手動調整が不要である。

これらの理由から、本研究では周波数分解に依存せず、生理学的に妥当な非対称サイン波モデルを基準とし、基準からの外れ（最小モデル残差）を一次特徴化するアプローチを採用した。

### 1.4 本研究の目的と評価

本研究では、3つの異なる血圧推定手法を実装し、比較する。第一に、形態学的特徴量（振幅、心拍数、相対Time-To-Peak）のみを使用した線形回帰モデル（RTBP: RealtimeBP）である。第二に、Sin波フィットのパラメータ（振幅、位相、平均値）を直接使用した線形回帰モデル（SinBP(M): SinBPModel）である。第三に、非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデル（SinBP(D): SinBPDistortion）である。

本研究の目的は以下の2点である：

1. **波形評価**: パルスオキシメーターの参照波形とrPPG実波形、Sin近似波を時間同期させ、MAPE（Mean Absolute Percentage Error）により波形の近似精度を評価する。これにより、Sin波近似が30fpsという低FPS環境において、実波形をどれだけ正確に近似できるかを定量化する。
2. **血圧推定精度の比較**: 連続血圧計を参照として、3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を比較し、Sin波を用いた手法（SinBP(M)、SinBP(D)）が本環境（30fps可視カメラ）において、従来の形態学的特徴量のみを用いた手法（RTBP）と比較して、本当に精度が高くなるのかを検証する。

### 1.5 本研究の貢献

本研究の主な貢献は以下の4点である：

1. **非対称サイン波基準の定義と、E・E√A（Stiffness_sin）に基づく推定枠組み**: 生理学的に妥当な非対称サイン波モデルを定義し、モデルからの残差（歪み指標E）と血管硬さ指標（Stiffness_sin = E√A）を特徴量として用いる新しい推定枠組みを提案する。非対称性は1拍遅延処理により実測データから自動計算される。
2. **IBI同期（拍ごとにT=IBI）かつピーク整合（位相探索）による比較可能な正規化**: 各拍のIBI（Inter-Beat Interval）に同期させ、データ駆動の位相探索により理想波のピークを実測ピークに整合させることで、拍ごとの変動を考慮した正規化を実現する。
3. **同一データ・同一前処理での対照実験計画**: 3つの異なる推定手法（RTBP、SinBP(M)、SinBP(D)）を同一データ・同一前処理で比較し、各手法の特徴量の寄与を定量化する。特に、Sin波をモデルとして用いた手法（SinBP(M)）と、Sin波の残差を用いた手法（SinBP(D)）の両方を比較する。
4. **30fps/可視カメラ前提の再現性重視プロトコル（交差検証・前登録・コード/閾値固定方針）**: 再現性を重視し、データ分割、ハイパーパラメータ、除外規則を前登録し、コードと閾値を固定した評価プロトコルを確立する。

---

## 2. 手法

### 2.1 システム全体の構成

本システムは、スマートフォンの可視カメラからPPG信号を取得し、3つの異なる手法で血圧を推定する。システム全体の構成を[システム全体のフロー図を挿入]に示す。

#### 2.1.1 データ取得と前処理

**カメラ設定**: Camera X APIを使用し、解像度240×180、フレームレート30fpsで画像を取得する。画像形式はYUV_420_888形式である。

**Green値抽出**: YUV画像のUプレーンからGreen値を抽出する。顔の中央領域（1/4～3/4）を除外し、周辺領域の平均値を計算することで、顔の中央部ではなく周辺部の血流変化を検出する。これにより、動脈の拍動による血流変化をより明確に捉えることができる。

**BaseLogic処理**: 抽出されたGreen値に対して、以下の共通処理を実施する：

- **ピーク検出**: 不応期8フレーム（約267ms）を設け、前後比較によるピーク検出を行う。ピーク検出条件は、前4フレームが単調増加し、現在フレームが前フレームより小さいことである。
- **IBI計算**: ピーク間隔からIBI（Inter-Beat Interval）を計算する。IBIの範囲は0.25秒～1.2秒（50～240 BPM相当）に制限し、この範囲外の値は外れ値として除外する。
- **特徴量抽出**: 各拍ごとに以下の特徴量を抽出する：

  - V2P_relTTP: 谷→山の相対Time-To-Peak（IBIに対する相対的な時間）
  - P2V_relTTP: 山→谷の相対Time-To-Peak
  - V2P_Amplitude: 谷→山の振幅
  - P2V_Amplitude: 山→谷の振幅
- **移動平均**: 10拍分の移動平均を計算し、ノイズの影響を低減する。

### 2.2 Sin波近似と非対称サイン波モデル

本研究では、3つの手法すべてでSin波近似を使用するが、その方法が異なる。RTBPはSin波近似を使用せず、形態学的特徴量のみを使用する。SinBP(M)は対称Sin波（通常の正弦波）をフィットし、そのパラメータを特徴量として使用する。SinBP(D)は非対称サイン波モデルをフィットし、その残差を特徴量として使用する。以下では、SinBP(M)とSinBP(D)で使用されるSin波近似について説明する。

#### 2.2.1 SinBP(M)における対称Sin波モデル

SinBP(M)では、1拍分のデータに対して通常の対称Sin波をフィットする。Sin波モデルは以下のように定義される：

\[
s(t) = \text{mean} + A \sin\left(\frac{2\pi t}{T} + \phi\right)
\]

ここで、Aは振幅、meanは平均値、φは位相、Tは周期（IBI）である。このモデルは対称であり、ピーク→谷と谷→ピークの時間が等しい。

#### 2.2.2 SinBP(D)における非対称サイン波モデルの定義

SinBP(D)では、生理学的に妥当な非対称サイン波モデルを使用する。PPG波形は、心臓の拍動に伴う動脈の拡張・収縮を反映している。生理学的には、収縮期（心臓が血液を送り出す期間）は拡張期（心臓が血液をためる期間）よりも短く、典型的には収縮期が周期の約1/3、拡張期が約2/3である。この非対称性を反映した非対称サイン波モデルを定義する。

非対称サイン波モデルは以下のように定義される：

\[
s(t) = \text{mean} + A \cdot s_{\text{norm}}(t)
\]

\[
s_{\text{norm}}(t) = \frac{1 + \cos(\theta(t) + \phi_0)}{2}
\]

\[
\theta(t) = \begin{cases}
\frac{3\pi}{2} \cdot \frac{t'}{T} & (0 \leq t' \leq \frac{2T}{3}) \\
\pi + 3\pi \cdot \frac{t' - \frac{2T}{3}}{T} & (\frac{2T}{3} < t' \leq T)
\end{cases}
\]

ここで、\(t' = (t - \tau^*) \bmod T\)は1拍内の位相時間、\(\phi_0\)は小さな位相シフト（実装で調整可）、\(\tau^*\)は各拍ごとに「\(s_{\text{norm}}(t)\)のピークが実測ピークと一致するように」T内で探索して決定する（ピーク合致の位相探索）。

このモデルにより、ピーク→谷が周期の2/3、谷→次ピークが1/3となる非対称波形を生成する。非対称サイン波モデルの形状を[非対称サイン波モデルの形状図を挿入]に示す。

#### 2.2.3 SinBP(D)における歪み指標Eの計算

SinBP(D)では、1拍分の実測データ\(x[n]\)（N点）に対して、非対称サイン波モデル\(s[n]\)をフィットし、残差RMS誤差を歪み指標Eとして計算する：

\[
E = \sqrt{\frac{1}{N} \sum_{n=1}^{N} (x[n] - s[n])^2}
\]

歪み指標Eは、実測波形が理想的な非対称サイン波モデルからどれだけ外れているかを定量化する。Eが大きいほど、波形の歪みが大きく、血管の硬さや動脈硬化の進行を示唆する。SinBP(M)では歪み指標Eは計算せず、Sin波パラメータのみを使用する。

#### 2.2.4 SinBP(D)における血管硬さ指標Stiffness_sin

歪み指標Eと振幅Aの平方根の積を、血管硬さ指標Stiffness_sinとして定義する：

\[
\text{Stiffness}_{\text{sin}} = E \sqrt{A}
\]

この指標は、血管の拡張能（振幅A）と波形の歪み（E）を組み合わせた合成指標であり、血管の硬さをより包括的に評価する。従来のAI（Augmentation Index）と比較して、30fpsという低FPS条件でも安定して計算できる利点がある。

### 2.3 3つの血圧推定手法

本研究では、3つの異なる血圧推定手法を実装し、比較する。各手法の特徴を[3手法の比較表を挿入]に示す。

#### 2.3.1 手法1: RTBP (RealtimeBP)

RTBPは、BaseLogicの形態学的特徴量のみを使用したシンプルな線形回帰モデルである。この手法は、波形の形状特徴（振幅、心拍数、相対TTP）を直接使用し、計算コストが低く、リアルタイム性に優れている。

**特徴量**:

- A: 振幅（averageValleyToPeakAmplitude）
- HR: 心拍数（60000.0 / smoothedIBI）
- V2P_relTTP: 谷→山の相対TTP
- P2V_relTTP: 山→谷の相対TTP

**推定式**:
\[
\text{SBP} = C_0 + C_1 \cdot A + C_2 \cdot \text{HR} + C_3 \cdot \text{V2P\_relTTP} + C_4 \cdot \text{P2V\_relTTP}
\]

\[
\text{DBP} = D_0 + D_1 \cdot A + D_2 \cdot \text{HR} + D_3 \cdot \text{V2P\_relTTP} + D_4 \cdot \text{P2V\_relTTP}
\]

**係数**: [後で記載]

**制約**: SBPは60～200 mmHg、DBPは40～150 mmHgの範囲に制限する。

#### 2.3.2 手法2: SinBP(M) (SinBPModel)

SinBP(M)は、Sin波フィットのパラメータ（振幅、位相、平均値）を直接使用した線形回帰モデルである。この手法は、1拍分のデータに対して最小二乗法でSin波をフィットし、そのパラメータを特徴量として使用する。

**データ処理**:

- **バッファリング**: 90フレーム（30fps × 3秒）のリングバッファにPPG値とタイムスタンプを保存する。
- **ピーク検出**: 移動窓最大値検出によりピークを検出し、不応期500msを設ける。
- **Sin波フィット**: 1拍分のデータを64点にリサンプリングし、DFT風の内積計算によりSin波パラメータを推定する。

Sin波モデルは以下のように定義される：

\[
s(t) = \text{mean} + A \sin\left(\frac{2\pi t}{T} + \phi\right)
\]

ここで、Aは振幅、meanは平均値、φは位相、Tは周期（IBI）である。

**特徴量**:

- A: 振幅（Sin波フィットから取得）
- HR: 心拍数（60000.0 / smoothedIBI）
- Mean: 平均値（Sin波フィットから取得）
- Phi: 位相（Sin波フィットから取得）

**推定式**:
\[
\text{SBP} = \alpha_0 + \alpha_1 \cdot A + \alpha_2 \cdot \text{HR} + \alpha_3 \cdot \text{Mean} + \alpha_4 \cdot \Phi
\]

\[
\text{DBP} = \beta_0 + \beta_1 \cdot A + \beta_2 \cdot \text{HR} + \beta_3 \cdot \text{Mean} + \beta_4 \cdot \Phi
\]

**係数**: [後で記載]

**制約**: SBPは60～200 mmHg、DBPは40～150 mmHgの範囲に制限する。

#### 2.3.3 手法3: SinBP(D) (SinBPDistortion)

SinBP(D)は、非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデルである。この手法は、生理学的に妥当な非対称サイン波モデルを基準とし、基準からの外れを定量化することで、より高精度な血圧推定を実現する。

**データ処理**:

- **バッファリング**: 90フレーム（30fps × 3秒）のリングバッファにPPG値とタイムスタンプを保存する。
- **ピーク検出**: 移動窓最大値検出によりピークを検出し、不応期500msを設ける。
- **1拍遅延処理**: 前の拍のデータを処理することで、より正確な非対称サイン波モデルを構築する。具体的には、次のピークが検出された時点で、その前の拍（previousPeakTime → lastPeakTime）のデータが完全になったので処理する。現在の拍のデータは次回処理する。
- **動的な収縮期/拡張期比率の自動計算**: 1拍遅延処理により、前の拍の実測データ（rPPG）から収縮期/拡張期比率を自動計算する。`calculateSystoleDiastoleRatio()`メソッドにより、実測データの谷位置を検出し、ピーク→谷の時間（拡張期）と谷→次ピークの時間（収縮期）から比率を算出する。デフォルトは1/3:2/3だが、実測値に基づいて動的に変更される。
- **Sin波フィット**: 1拍分のデータに対してSin波をフィットし、振幅Aと位相φを取得する。
- **歪み指標計算**: 計算された動的な比率を用いて非対称サイン波モデルを再構成し、実測データからの残差RMS誤差を計算して歪み指標Eを算出する。

**特徴量**:

- A: 振幅（Sin波フィットから取得）
- HR: 心拍数（60000.0 / smoothedIBI）
- V2P_relTTP: 谷→山の相対TTP（BaseLogicから取得）
- P2V_relTTP: 山→谷の相対TTP（BaseLogicから取得）
- Stiffness_sin: E√A（歪み指標×振幅の平方根）
- E: 歪み指標（RMS誤差）

**推定式（3段階推定）**:

【第1段: ベースBP計算】
\[
\text{SBP}_{\text{base}} = \text{ALPHA}_0 + \text{ALPHA}_1 \cdot A + \text{ALPHA}_2 \cdot \text{HR}
\]

\[
\text{DBP}_{\text{base}} = \text{BETA}_0 + \text{BETA}_1 \cdot A + \text{BETA}_2 \cdot \text{HR}
\]

【第2段: 血管特性補正】
\[
\text{SBP}_{\text{vascular}} = \text{SBP}_{\text{base}} + \text{ALPHA}_3 \cdot \text{V2P\_relTTP} + \text{ALPHA}_4 \cdot \text{P2V\_relTTP} + \text{ALPHA}_5 \cdot \text{Stiffness}_{\text{sin}}
\]

\[
\text{DBP}_{\text{vascular}} = \text{DBP}_{\text{base}} + \text{BETA}_3 \cdot \text{V2P\_relTTP} + \text{BETA}_4 \cdot \text{P2V\_relTTP} + \text{BETA}_5 \cdot \text{Stiffness}_{\text{sin}}
\]

【第3段: 歪み補正】
\[
\text{SBP} = \text{SBP}_{\text{vascular}} + \text{ALPHA}_6 \cdot E
\]

\[
\text{DBP} = \text{DBP}_{\text{vascular}} + \text{BETA}_6 \cdot E
\]

**係数**: [後で記載]

**制約**: SBP >= DBP + 10、SBPは60～200 mmHg、DBPは40～150 mmHgの範囲に制限する。

3段階推定のフローを[SinBP(D)の3段階推定フロー図を挿入]に示す。

### 2.4 前処理と正規化

#### 2.4.1 ピーク検出

各手法でピーク検出を実施する。BaseLogicでは不応期8フレーム（約267ms）を設け、SinBP(M)とSinBP(D)では不応期500msを設ける。ピーク検出アルゴリズムは移動窓最大値検出を使用し、前後比較によりピークを確定する。

#### 2.4.2 ビート切り出し

現在ピークから次ピークまでを1拍として切り出す。周期TはIBI（Inter-Beat Interval）に等しい。

#### 2.4.3 時間正規化

各拍を固定長（N=64点）にリサンプリングする。線形補間を使用し、元のサンプル数を64点に正規化する。この処理は、SinBP(M)とSinBP(D)で実施される。RTBPは形態学的特徴量のみを使用するため、時間正規化は不要である。

#### 2.4.4 ピーク整合

SinBP(M)とSinBP(D)では、各拍で位相探索（τ*）により理想波のピークを実測ピークに一致させる。これにより、拍ごとの位相変動を考慮した正規化を実現する。RTBPは形態学的特徴量のみを使用するため、ピーク整合は不要である。

#### 2.4.5 外れ値抑制

IBI・振幅・テンポラルジャンプに基づくルールベース除外を実施する。具体的には、以下の条件を満たす拍を外れ値として除外する：

- IBIが0.25秒～1.2秒の範囲外
- 振幅が前回の30%以上変化
- 生理学的に妥当でない値（脈圧が20～100 mmHgの範囲外など）

---

## 3. 実験計画

### 3.1 データ取得プロトコル

#### 3.1.1 環境設定

- **デバイス**: スマートフォン可視カメラ（30fps）
- **測定方式**: 指腹接触方式
- **照明条件**: 室内/屋外/点滅を層別化
- **その他**: 指圧、スキントーンを層別化

#### 3.1.2 参照値

- **参照デバイス**: 上腕カフ（臨床グレード）で同時計測
- **測定条件**: 測定間隔・体位・安静時間を統一

#### 3.1.3 被験者

- **募集条件**: 年齢/性別/スキントーンが偏らないよう募集
- **除外条件**: 不整脈重度等

#### 3.1.4 倫理

同意取得・匿名化・暗号化保存を実施する。

### 3.2 波形評価実験

#### 3.2.1 評価目的

パルスオキシメーターの参照波形とrPPG実波形、Sin近似波を時間同期させ、MAPEにより波形の近似精度を評価する。これにより、Sin波近似が30fpsという低FPS環境において、実波形をどれだけ正確に近似できるかを定量化する。

#### 3.2.2 データ取得

- **参照波形**: パルスオキシメーターから取得したPPG波形を参照とする
- **rPPG実波形**: スマートフォン可視カメラから取得したrPPG実波形
- **Sin近似波**: SinBP(M)とSinBP(D)で計算されたSin近似波

#### 3.2.3 時間同期

パルスオキシメーターとrPPG実波形、Sin近似波を時間同期させる。同期方法は以下のいずれかを使用する：

- **ピーク同期**: 各拍のピーク位置を基準に同期
- **相関最大化**: 相互相関を最大化するように時間シフトを決定

#### 3.2.4 評価指標

時間同期した波形に対して、MAPEを計算する：

\[
\text{MAPE} = \frac{100}{n}\sum_{i=1}^{n}\left|\frac{\hat{y}_i - y_i}{y_i}\right|
\]

ここで、\(\hat{y}_i\)はSin近似波、\(y_i\)は参照波形（パルスオキシメーター）またはrPPG実波形である。

波形評価の結果を[波形評価の結果グラフを挿入]に示す。

### 3.3 血圧推定精度の比較実験

全手法が同じ拍列・同じ正規化系列を入力する前提で比較する。学習/検証の分割は完全共通とする。

#### 3.3.1 3手法の比較

3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を比較する：

- **RTBP**: 形態学的特徴量のみを使用した手法（ベースライン）
- **SinBP(M)**: Sin波パラメータを直接使用した手法
- **SinBP(D)**: Sin波の残差（歪み指標E）を用いた手法

各手法の特徴量の違いを[3手法の特徴量比較表を挿入]に示す。

#### 3.3.2 アブレーション研究

3手法の各要素の寄与を定量化する：

**RTBPのアブレーション**:
- **(i) A・HR のみ**: ベースライン
- **(ii) + V2P_relTTP**: 谷→山の相対TTPの寄与
- **(iii) + P2V_relTTP**: 山→谷の相対TTPの寄与

**SinBP(M)のアブレーション**:
- **(i) A・HR のみ**: ベースライン
- **(ii) + Mean**: 平均値の寄与
- **(iii) + Phi**: 位相の寄与

**SinBP(D)のアブレーション**:
- **(i) A・HR のみ**: ベースライン
- **(ii) + relTTP（谷→山・山→谷の両方向）**: 血管特性の寄与
- **(iii) + Stiffness_sin（E√A）**: 血管硬さ指標の寄与
- **(iv) + E（最終）**: 歪み指標の寄与

各段での寄与を定量化する。アブレーション研究の結果を[アブレーション研究の結果グラフを挿入]に示す。

### 3.4 検証設計・統計計画

#### 3.4.1 データ分割

- **主要**: 被験者独立のLOSO（Leave-One-Subject-Out）
- **サブ解析**: K-fold（被験者分割）

#### 3.4.2 評価指標

- **主要指標**: SBP/DBP MAE, MD±SD, Bland–Altman, CCC
- **基準**:
  - AAMI（|MD|≤5 mmHg かつ SD≤8 mmHg）
  - BHS（≤5/10/15 mmHg の累積比率）

#### 3.4.3 統計検定

- **比較**: 提案法 vs 各ベースラインの二者比較（対応あり）
- **信頼区間**: MD差の95% CI、ブートストラップで頑健CI
- **多重性補正**: Holm法で補正

#### 3.4.4 事前仮説

- **H1**: Sin波を用いた手法（SinBP(M)、SinBP(D)）は、形態学的特徴量のみを用いた手法（RTBP）と比較して、30fps条件においてMAEが小さい
- **H2**: SinBP(D)の歪み指標EとStiffness_sinは、血圧推定に独立寄与を持つ（重回帰の部分相関/分散説明率）
- **H3**: ノイズ・照度・スキントーン層で性能低下が小さい（交互作用が小）
- **H4**: Sin近似波のMAPEは、rPPG実波形のMAPEと比較して小さい（Sin波近似が有効である）

#### 3.4.5 リーク防止

- スケール/正規化/閾値は訓練内のみで決定、検証には適用のみ
- 同一被験者の交差漏れを禁止

### 3.5 ロバスト性試験

#### 3.5.1 ノイズ耐性

ホワイト/低周波ドリフト/照度ゆらぎの合成撹乱を加え、3手法（RTBP、SinBP(M)、SinBP(D)）の性能を評価する。各手法のノイズに対する頑健性を比較する。

#### 3.5.2 FPS依存

30fps → 24/20fpsサブサンプリングで劣化曲線を評価する。3手法（RTBP、SinBP(M)、SinBP(D)）のFPS依存性を比較する。

#### 3.5.3 モーション

微小動揺の再現（微分エネルギー閾値）を評価する。3手法（RTBP、SinBP(M)、SinBP(D)）のモーション耐性を比較する。

#### 3.5.4 皮膚特性

スキントーン層別のMAE/MD±SDを報告する。3手法（RTBP、SinBP(M)、SinBP(D)）の皮膚特性への依存性を比較する。

---

## 4. 結果

[後で記載]

### 4.1 波形評価の結果

[後で記載]

パルスオキシメーターの参照波形とrPPG実波形、Sin近似波（SinBP(M)、SinBP(D)）の時間同期したMAPEを報告する。波形評価の結果を[波形評価の結果グラフを挿入]に示す。

### 4.2 3手法の血圧推定精度の比較結果

[後で記載]

連続血圧計を参照として、3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）の精度を比較する。MAE、RMSE、Bland-Altmanプロットを報告する。3手法の比較結果を[3手法の比較結果グラフを挿入]に示す。

### 4.3 アブレーション研究の結果

[後で記載]

3手法（RTBP、SinBP(M)、SinBP(D)）の各要素の寄与を定量化する。各手法における特徴量の段階的追加による性能変化を報告する。アブレーション研究の結果を[アブレーション研究の結果グラフを挿入]に示す。

### 4.4 ロバスト性試験の結果

[後で記載]

---

## 5. 考察

[後で記載]

### 5.1 結果の解釈

[後で記載]

### 5.2 手法の優位性

[後で記載]

### 5.3 限界と今後の課題

[後で記載]

---

## 6. 結論

本研究は、可視カメラ×30fpsの制約下で機能する3つの異なる血圧推定手法（RTBP、SinBP(M)、SinBP(D)）を、厳密な対照実験計画とともに提示した。RTBPは形態学的特徴量のみを使用したシンプルな線形回帰モデル、SinBP(M)はSin波パラメータを直接使用した線形回帰モデル、SinBP(D)は非対称サイン波モデルからの残差（歪み指標E）を特徴量として使用した3段階推定モデルである。同一データ・同一前処理・同一分割で3手法を比較し、SinBP(D)ではE・E√A・relTTPの段階的寄与を検証する。実装では各拍のIBI同期、ピーク合致の位相探索（SinBP(M)とSinBP(D)）、そして表示上は振幅の視覚強調（中心から1.5倍拡大）を行い、同期性と視認性を両立した。

30fps環境での優位性として、周波数分解に頼らず、Sin波近似（SinBP(M)）や非対称サイン骨格＋最小モデル残差（SinBP(D)）で安定した推定を実現できることを示した。物理解釈性の観点から、SinBP(D)のEは「生理整合的な基準」からの逸脱量、E√A（Stiffness_sin）は拡張能×歪みの合成指標として解釈できる。実装容易性の観点から、SinBP(M)とSinBP(D)は少数パラメータ・軽量でオンデバイス適合が可能であり、位相はデータ駆動で自動整合される。RTBPは計算コストが最も低く、リアルタイム性に優れている。

今後の課題として、単一基準形の限界（個体差・切痕の強い症例では二成分化/局所バンプで拡張）、撮像依存性（条件別バイアスは個体内標準化・層別補正で緩和）、一般化（被験者外検証と外部データ再現で担保）が挙げられる。

---

## 参考文献

[後で記載]

---

## 付録

### A. 実装の詳細

#### A.1 非対称サイン波基底関数の実装

非対称サイン波基底関数は、動的な収縮期/拡張期比率に対応して実装されている。実装コードの主要部分を以下に示す：

```java
private double asymmetricSineBasis(double t, double T, 
                                    double systoleRatio, 
                                    double diastoleRatio) {
    double phase = (t % T) / T;
    double value;
    if (phase <= diastoleRatio) {
        // ピーク→谷: diastoleRatioの時間
        double angle = phase * (1.0/diastoleRatio) * Math.PI;
        value = Math.cos(angle + PHASE_SHIFT);
    } else {
        // 谷→ピーク: systoleRatioの時間
        double angle = Math.PI + (phase - diastoleRatio) * 
                       (1.0/systoleRatio) * Math.PI;
        value = Math.cos(angle + PHASE_SHIFT);
    }
    return (value + 1.0) / 2.0;  // [0,1]に正規化
}
```

#### A.2 歪み指標の計算

歪み指標Eは、非対称サイン波モデルからの残差RMS誤差として計算される：

```java
private void calculateDistortion(List<Double> beatSamples, double A,
                                 double systoleRatio, double diastoleRatio) {
    double mean = 0;
    for (double sample : beatSamples) {
        mean += sample;
    }
    mean /= beatSamples.size();
  
    double sumSquaredError = 0;
    int N = beatSamples.size();
    double T = ibi;
  
    for (int i = 0; i < N; i++) {
        double t = (double) i * T / N;
        double sNorm = asymmetricSineBasis(t, T, systoleRatio, diastoleRatio);
        double idealValue = mean + A * sNorm;
        double error = beatSamples.get(i) - idealValue;
        sumSquaredError += error * error;
    }
  
    currentE = Math.sqrt(sumSquaredError / N);  // RMS誤差
}
```

### B. 評価指標の詳細

#### B.1 MAPE（Mean Absolute Percentage Error）

\[
\text{MAPE} = \frac{100}{n}\sum_{i=1}^{n}\left|\frac{\hat{y}_i - y_i}{y_i}\right|
\]

#### B.2 MAE（Mean Absolute Error）

\[
\text{MAE} = \frac{1}{n}\sum_{i=1}^{n}|\hat{y}_i - y_i|
\]

#### B.3 RMSE（Root Mean Squared Error）

\[
\text{RMSE} = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(\hat{y}_i - y_i)^2}
\]

#### B.4 Bland-Altmanプロット

Bland-Altmanプロットは、推定値と参照値の一致度を視覚化する手法である。横軸に平均値、縦軸に差をプロットし、95%一致限界を表示する。

### C. 統計検定の詳細

#### C.1 対応ありt検定

提案法とベースライン手法の平均誤差（MD）の差を、対応ありt検定により検定する。

#### C.2 多重性補正

Holm法により、複数の仮説検定における多重性を補正する。

---

**作成日**: 2025年
**最終更新**: 2025年
